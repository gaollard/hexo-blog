---
tags: Mysql
---

## 1、执行一次 mysql 查询，会进行几次 tcp 通讯

执行一次MySQL查询大致会进行两次TCP通信：
1. 建立连接：客户端与MySQL服务器通过TCP建立连接。

2. 执行查询：完成建立连接后，客户端向MySQL服务器发送查询请求，MySQL服务器返回查询结果，此过程中也是使用TCP进行通讯。

需要注意的是，在执行查询过程中，通信次数还会受到一些其他因素的影响，如查询的复杂程度、表的大小、网络状况等。但是，通常情况下，MySQL查询都会进行至少两次TCP通信。

## 2、执行查询的详细过程

MySQL查询的详细过程如下：
1. 客户端向MySQL服务器发送查询请求，通过TCP套接字发送一个SQL命令字符串到MySQL服务器。

2. MySQL服务器收到查询请求后，解析SQL命令，如SELECT、INSERT等，并对命令进行合法性验证，例如检查语法错误和访问权限。

3. 如果SQL语句合法，则服务器会执行SQL查找数据或修改数据的操作。对于一个SELECT查询，服务器会将结果集拆分为多个数据包发送给客户端。对于INSERT、UPDATE和DELETE语句，服务器会返回命令执行的结果信息。

4. 客户端接收到MySQL服务器返回的数据时，通过TCP套接字将结果集字节流传输到本地计算机内存中，然后将结果集数据转化为程序内部的数据结构，如二维数组、哈希表等。

5. 客户端处理结果集数据，例如进行数据分析、统计和展示等操作。

6. 客户端释放结果集内存并关闭TCP套接字连接。

## 3、抓包分析

![20230506165553](http://s3.airtlab.com/blog/20230506165553.png)

![20230506165632](http://s3.airtlab.com/blog/20230506165632.png)

![20230506165647](http://s3.airtlab.com/blog/20230506165647.png)

## 4、mysql 通讯协议